<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.css">
    <style>
        .footer {
            bottom: 0;
            width: 100%;
            /* Set the fixed height of the footer here */
            height: 200px;
            line-height: 60px;
            margin-top: 40px;
            /* Vertically center the text there */
            background-color: #86171f;
        }

        .navbar {
            background-color: #86171f;
        }

        #info {
            display: none;
        }

        #registro-invitados {
            display: none;
        }

        .container {
            margin-bottom: 10px;
        }
    </style>
</head>

<body>
    <header>
        <nav class="navbar navbar-default">
            <div class="container-fluid">
                <div class="navbar-header">
                    <a class="navbar-brand" href="#">
                        <img src="http://fonvalle.com.co/portal/images/logo-fonvalle.png" />
                    </a>
                </div>
                <!-- <ul class="nav navbar-nav">
                                <li class="active">
                                    <a href="#">Home</a>
                                </li>
                                <li>
                                    <a href="#">Page 1</a>
                                </li>
                                <li>
                                    <a href="#">Page 2</a>
                                </li>
                                <li>
                                    <a href="#">Page 3</a>
                                </li>
                            </ul>-->
            </div>
        </nav>
    </header>
    <main>
        <br>
        <div class="container">
            <div class="row">
                <div class="jumbotron" style="margin: auto">
                    <h2>Ingrese Documento de Identidad</h2>
                    <br/>
                    <div class="input-group">
                        <input type="number" class="form-control numeric" id="cedula_buscada" placeholder="Ingrese documento de identidad">
                        <span class="input-group-btn">
                            <button id="btn-buscar" onclick="cargarInfo()" class="btn btn-primary" type="button">Buscar</button>
                        </span>
                    </div>
                    <br/>
                    <hr/>
                    <div id="info">
                        <form>
                            <div class="form-group row">
                                <label for="staticNombre" class="col-sm-2 col-form-label">Nombre:</label>
                                <div class="col-sm-4">
                                    <input type="text" readonly class="form-control-plaintext" id="staticNombre">
                                </div>
                                <label for="staticCedula" class="col-sm-2 col-form-label">Cedula:</label>
                                <div class="col-sm-4">
                                    <input type="text" readonly class="form-control-plaintext" id="staticCedula">
                                </div>
                            </div>

                            <div class="form-group row">
                                <label for="staticInvitados" class="col-sm-3 col-form-label">Numero de asistentes:</label>
                                <div class="col-sm-2">
                                    <select class="custom-select mr-sm-2" id="staticInvitados">
                                            <option value="1">1</option>
                                            <option value="2">2</option>
                                            <option value="3">3</option>
                                            <option value="4">4</option>
                                            <option value="5">5</option>
                                            <option value="6">6</option>
                                            <option value="7">7</option>
                                            <option value="8">8</option>
                                            <option value="9">9</option>
                                    </select>
                                </div>
                                <div class="col-sm-4">
                                    <button id="btn-inivitados" onclick="registraInvitados()" class="btn btn-primary" type="button">Registrar</button>
                                </div>
                            </div>
                            <br/>
                            <div id="registro-invitados">
                            </div>
                        </form>
                    </div>
                </div>
                <br/>
            </div>
        </div>
    </main>
    <footer class="footer">
        <div class="container">
            <div class="row">
                <div class="col-md-3 col-md-offset-2">
                    <img src="http://fonvalle.com.co/portal/images/logo-fonvalle-footer.png" alt="" style="margin-top: 10px;">
                </div>
                <div class="col-md-6">

                </div>
                <div class="col-md-3 " style="background-color: #d9d9d9">
                    <img src="https://drive.google.com/uc?id=12Cb6h1t1EaL9Nzc79kDgf19oK1APryIc" alt="">
                </div>
            </div>
        </div>
    </footer>
    <script>

        function cargarInfo() {
            var cedula = $('#cedula_buscada').val();
            google.script.run.withSuccessHandler(cargarPersona).buscarPersona(cedula);
        }
        function cargarPersona(p) {
            var persona = p.inscrito;
            console.log('THIS IS SPARTA', p);
            if (persona == 2) {
                swal({
                    title: 'Ya se registro el dia de hoy',
                    text: 'La cedula ingresada ya fue registrada el dia de hoy',
                    type: 'error',
                });
            } else
                if (persona) {
                    mostrarInfo(persona, p.index);
                    // swal({
                    //     title: "Registro Encontrado",
                    //     text: persona[0] + " " + persona[1],
                    //     type: 'success',
                    // });
                } else {
                    swal({
                        title: 'Registro No Encontrado',
                        text: 'La c√©dula o nombre ingresado no corresponde a ninguna inscipcion,\n Acerquese a incripciones',
                        type: 'error',
                    });
                }
        }

        var PERSON_INDEX = 0;
        function mostrarInfo(persona, index) {
            $('#info').css('display', 'block');
            $('#staticNombre').val(persona[0] + " " + persona[1]);
            $('#staticCedula').val(persona[2]);
            PERSON_INDEX = index;
        }

        function registraInvitados() {
            $('#registro-invitados').css('display', 'block');
            var nInvitados = $('#staticInvitados').val();

            for (var i = 0; i < nInvitados; i++) {
                var fixed = i + 1;
                $('#registro-invitados').append(`
                    <div class="form-group row">
                        <label class="col-sm-3 col-form-label"  style="margin-right:-20px">Invitado ${fixed}:</label>
                        <div class="col-sm-6" style="padding-left: -20px; ">
                            <select class="custom-select mr-sm-2" id="item-licor-${fixed}">
                                <option value="sin_reclamo">Sin reclamar</option>
                                <option value="Caneca_agua">Caneca de Aguardiente</option>
                                <option value="Caneca_ron">Caneca de Ron</option>
                                <option value="Botella_vino">Botella de Vino</option>
                            </select>
                        </div>
                        <label style="margin-left: -20px; padding-left: -20px" for="item-licor-${fixed}" class="col-sm-1 col-form-label">Licor</label>                    
                        <div class="col-sm-1 form-check" style="margin-left:30px; margin-top: 10px;">
                                <input type="checkbox" class="form-check-input" id="item-cena-${fixed}">
                                <label class="form-check-label" for="customControlAutosizing">Cena </label>
                        </div>
                    </div>
                    `);
            }
            var count = 0;
            for (var j = nInvitados; j > 2; j -= 2) {
                count++;
                $('#registro-invitados').append(`
                    <br/>
                    <div class="form-group row">
                    <div class="col-sm-6">
                            <select class="custom-select mr-sm-2" id="item-adicional-${count}">
                                <option value="sin_reclamo">Sin reclamar</option>
                                <option value="caneca_agua">Caneca de Aguardiente</option>
                                <option value="caneca_ron">Caneca de Ron</option>
                                <option value="botella_vino">Botella de Vino</option>
                            </select>
                        </div>
                        <label for="item-adicional-${count}" class="col-sm-4 col-form-label">Licor adicional</label>                    
                    </div>
                    `)
            }
            $('#registro-invitados').append(`
                <button id="btn-registra-asistencia"  class="btn btn-primary " type="button">Actualizar</button>
                    `)

            $('#btn-registra-asistencia').on('click', function () {
                var formValues = getFormValues(nInvitados);
                google.script.run.withSuccessHandler(mostrarResultado).registrarAsistencia(formValues);
            });

        }

        function mostrarResultado(bool) {
            bool ? (swal({
                title: "Exito",
                text: "Datos almacenados de forma correcta",
                type: 'success',
            }).then(()=>location.reload())) : console.log('its not')
        }

        function getFormValues(n) {
            var results = { invitados: [], adicionales: [], index: PERSON_INDEX };
            for (var i = 0; i < n; i++) {
                var invitado = { licor: "", cena: false }
                var licor = $(`#item-licor-${i + 1}`).val();
                var cena = $(`#item-cena-${i + 1}`).is(':checked');
                invitado.licor = licor;
                invitado.cena = cena;
                results.invitados.push(invitado);
            }
            var count = 0;
            for (var j = n; j > 1; j -= 2) {
                count++;
                var adicional = $(`#item-adicional-${count}`).val();
                results.adicionales.push(adicional);
            }
            console.log(results);
            return results;
        }

    </script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.js"></script>
</body>

</html>